server:
  port: 8085

spring:
  application:
    name: audit-service

  datasource:
    url: jdbc:mysql://localhost:3307/audit_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: audit_user
    password: audit_pass
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect

  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: audit-service
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.ehrplatform.audit.dto"
        spring.json.value.default.type: "com.ehrplatform.audit.dto.AuditEventMessage"
      enable-auto-commit: false
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    listener:
      ack-mode: manual

# Audit service configuration
audit:
  kafka:
    topic: audit-events
  hash:
    genesis: "GENESIS_HASH_EHR_PLATFORM_2026"
  alerts:
    enabled: true
    schedule:
      fixed-rate: 60000  # 1 minute
    thresholds:
      failed-login-count: 5
      failed-login-window-minutes: 5
      denied-access-count: 20
      denied-access-window-minutes: 5
      export-spike-count: 10
      export-spike-window-minutes: 10
      bulk-access-patient-count: 50
      bulk-access-window-minutes: 10

# JWT Configuration (same secret as gateway)
jwt:
  secret: "CHANGE_THIS_TO_A_LONG_RANDOM_SECRET_AT_LEAST_32_CHARS"
  issuer: "identity-service"
  audience: "your-audience"

logging:
  level:
    com.ehrplatform.audit: DEBUG
    org.springframework.kafka: INFO
    org.apache.kafka: WARN
